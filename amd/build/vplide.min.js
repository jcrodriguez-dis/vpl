define(["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplidefile","mod_vpl/vplidebutton","mod_vpl/vplterminal","mod_vpl/vplvnc"],function(a,b,c,d,e,f,g){if("undefined"!=typeof i)return i;var h,i=function(b,i){function j(a){return!R[a]||i[a]}function k(a){L?a.originalEvent.dataTransfer.dropEffect="none":a.originalEvent.dataTransfer.dropEffect="copy",a.preventDefault()}function l(a){if(L)return a.stopImmediatePropagation(),!1;var b=a.originalEvent.dataTransfer;return b.files.length>0?(c.readSelectedFiles(b.files,function(a){return D.addFile(a,!0,H,G)},function(){D.fileListVisibleIfNeeded()}),a.stopImmediatePropagation(),!1):void 0}function m(a){if(L)return a.stopPropagation(),!1}function n(a,b){if("newHeader"in b&&b.newHeader.hasClass("vpl_ide_accordion_t_grade"))return!1}function o(){function b(a){for(var b=a.toLowerCase()+"/",c=0;c<j.length;c++){var d=j[c].getFileName().toLowerCase()+"/";if(0===d.indexOf(b)||0===b.indexOf(d))return!0}return!1}function e(a,b){if(c.isBlockly(a))return!1;if(c.isBlockly(b))for(var d=0;d<j.length;d++)if(c.isBlockly(j[d].getFileName()))return!0;return!1}var f=a("#vpl_tabs_ul"),g=a("#vpl_tabs").tabs("widget"),j=[],n=[],o=!0,p=this;this.updateFileList=function(){p.generateFileList()},this.fileNameExists=function(a){for(var b=a.toLowerCase(),c=0;c<j.length;c++)if(j[c].getFileName().toLowerCase()==b)return c;return-1},this.restrictedPaste=m,this.dropHandler=l,this.dragoverHandler=k,this.readOnly=M,this.restrictedEdit=L,this.adjustTabsTitles=E,this.minNumberOfFiles=J,this.scrollBarWidth=O;var q="";this.setClipboard=function(a){q=a},this.getClipboard=function(){return q},this.getTabPos=function(a){for(var b=0;b<n.length;b++)if(n[b]==a)return b;return n.length},this.getTheme=function(){return i.theme},this.setTheme=function(a){i.theme=a;for(var b=0;b<j.length;b++)j[b].setTheme(a)},this.addTab=function(a){var b='<a href="#vpl_file'+a+'"></a>';f.append('<li id="vpl_tab_name'+a+'">'+b+"</li>"),g.append('<div id="vpl_file'+a+'" class="vpl_ide_file"></div>')},this.removeTab=function(a){f.find("#vpl_tab_name"+a).remove(),g.find("#vpl_file"+a).remove()},this.open=function(a){var b;if(b="object"==typeof a?a:j[a],!b.isOpen()){var d=b.getId();p.addTab(d),n.push(b),T.setGetkeys(b.open()),g.tabs("refresh"),E(!1),c.delay("updateMenu",H),c.delay("updateFileList",p.updateFileList)}},this.close=function(a){if(a.isOpen()){var b,d=a.getId();a.close(),p.removeTab(d);var e=p.getTabPos(a);return n.splice(e,1),g.tabs("refresh"),E(!1),p.fileListVisible(!0),c.delay("updateFileList",p.updateFileList),c.delay("adjustTabsTitles",E,!1),n.length>e?(b=p.getFilePosById(n[e].getId()),void p.gotoFile(b,"c")):e>0?(b=p.getFilePosById(n[e-1].getId()),void p.gotoFile(b,"c")):void 0}},this.isClosed=function(a){return!j[a].isOpen()},this.fileListVisible=function(a){a!==V.vpl_visible&&(V.vpl_visible=a,a?(V.show(),F()):(V.hide(),F()))},this.isFileListVisible=function(){return V.vpl_visible},this.fileListVisibleIfNeeded=function(){if(!this.isFileListVisible())for(var a=0;a<j.length;a++)if(!j[a].isOpen())return void this.fileListVisible(!0)},this.setFontSize=function(a){i.fontSize=a;for(var b=0;b<j.length;b++)j[b].setFontSize(a)},this.getFontSize=function(){return i.fontSize},this.addFile=function(a,f,g,i){if("string"!=typeof a.name||!c.validPath(a.name))return i(P("incorrect_file_name")+" ("+a.name+")"),!1;f!==!0&&(f=!1);var k=this.fileNameExists(a.name);if(k!=-1)return f?(j[k].setContent(a.contents),p.setModified(),g(),c.delay("updateFileList",p.updateFileList),a):(i(P("filenotadded").replace(/\{\$a\}/g,a.name)),!1);if(b(a.name)||e("",a.name))return i(P("filenotadded").replace(/\{\$a\}/g,a.name)),!1;if(j.length>=K)return i(P("maxfilesexceeded")+" ("+K+")"),!1;var l=c.getUniqueId(),m=new d(l,a.name,a.contents,this,h);return 1==a.encoding?m.extendToBinary():c.isBlockly(a.name)?m.extendToBlockly():m.extendToCodeEditor(),j.push(m),p.setModified(),j.length>5&&p.fileListVisible(!0),g(),c.delay("updateFileList",p.updateFileList),m},this.renameFile=function(a,d,f){var g=this.fileNameExists(a);try{if(g==-1)throw"";if(g<J)throw"";if(j[g].getFileName()==d)return!0;if(!c.validPath(d)||b(d)||e(a,d))throw P("incorrect_file_name");if(c.isBinary()&&c.fileExtension(a)!=c.fileExtension(d))throw P("incorrect_file_name");if(!c.isBlockly(a)&&c.isBlockly(d)||c.isBlockly(a)&&!c.isBlockly(d))throw P("incorrect_file_name");j[g].setFileName(d)}catch(h){return f(P("filenotrenamed").replace(/\{\$a\}/g,d)+": "+h),!1}return p.setModified(),E(!1),c.delay("updateFileList",p.updateFileList),!0},this.deleteFile=function(a,b,d){var e=this.fileNameExists(a);return e==-1?(d(P("filenotdeleted").replace(/\{\$a\}/g,a)),!1):e<J?(d(P("filenotdeleted").replace(/\{\$a\}/g,a)),!1):(p.setModified(),p.close(j[e]),j.splice(e,1),c.delay("updateFileList",p.updateFileList),!0)},this.currentFile=function(){var a=g.tabs("option","active");if(a in n){var b=n[a];if(0===arguments.length)return b;var c=arguments[0];if("function"==typeof b[c]){var d=b[c],e=Array.prototype.slice(arguments);return e.shift(),d.apply(b,e)}}return!1},this.currentPos=function(){return g.tabs("option","active")},this.getFileTab=function(a){for(var b=0;b<n.length;b++)if(n[b].getId()==a)return b;return-1},this.getFilePosById=function(a){for(var b=0;b<j.length;b++)if(j[b].getId()==a)return b;return-1},this.gotoFile=function(a,b){var c=j[a];p.open(c),g.tabs("option","active",p.getFileTab(c.getId())),"c"!==b&&c.gotoLine(parseInt(b,10)),c.focus()},this.gotoFileLink=function(b){var c=a(b),d=c.data("file"),e=-1;if(e=d>""?this.fileNameExists(d):p.getFilePosById(c.data("fileid")),e>=0){var f=c.data("line");"undefined"==typeof f&&(f="c"),p.gotoFile(e,f)}},this.getFilesToSave=function(){for(var a=[],b=0;b<j.length;b++){var c={};c.name=j[b].getFileName(),c.contents=j[b].getContent(),c.encoding=j[b].isBinary()?1:0,a.push(c)}return a},this.resetModified=function(){o=!1;for(var a=0;a<j.length;a++)j[a].resetModified();c.delay("updateMenu",H),c.delay("updateFileList",p.updateFileList)},this.setModified=function(){o||(o=!0,c.delay("updateFileList",p.updateFileList)),c.delay("updateMenu",H)},this.isModified=function(){return o},this.length=function(){return j.length},this.clearAnnotations=function(){for(var a=0;a<j.length;a++)j[a].clearAnnotations()},this.getFile=function(a){return j[a]},this.getFiles=function(){return j},this.getDirectoryStructure=function(){var a={isDir:!0,content:{}};for(var b in j)if(j.hasOwnProperty(b)){var c=j[b],d=c.getFileName(),e=d.split("/"),f=a;for(var g in e)if(e.hasOwnProperty(g)){var h=e[g];g==e.length-1?f.content[h]={isDir:!1,content:c,pos:b}:(f.content[h]||(f.content[h]={isDir:!0,content:{}}),f=f.content[h])}}return a},this.generateFileList=function(){function a(d,e,f){for(var g in d.content)if(d.content.hasOwnProperty(g)){var h=d.content[g];if(h.isDir)f.push(e+c.iconFolder()+c.sanitizeText(g)),a(h,e+b,f);else{var i=h.content,j=c.sanitizeText(g),k=c.sanitizeText(i.getFileName());i.isOpen()&&(j="<b>"+j+"</b>");var l='href="#" data-fileid="'+i.getId()+'" title="'+k+'"',m="<a "+l+">"+j+"</a>";i.isModified()&&(m=c.iconModified()+m),h.pos<J&&(m+=c.iconRequired()),f.push(e+m)}}}if(p.isFileListVisible()){var b='<span class="vpl_ide_dirindent"></span>',d=p.getDirectoryStructure(),e=[],f="";a(d,"",e);for(var g=0;g<e.length;g++)f+=e[g]+"<br />";X.html("<div>"+f+"</div>")}},f.on("click","span.vpl_ide_closeicon",function(){D.close(D.currentFile())}),f.on("dblclick","span.vpl_ide_closeicon",T.getAction("delete")),f.on("dblclick","a",T.getAction("rename")),X.on("dblclick","a",T.getAction("rename"))}function p(){return aa===!1&&(aa=(Z.outerWidth(!0)-Z.width())/2),aa}function q(a,b){var c,d=b.position.left-b.originalPosition.left;if(0!==d)c=Z.width()+V.width()-V.vpl_minWidth,Z.resizable("option","maxWidth",c),V.width(V.vpl_original_width+d);else{c=Z.width()+$.width()-$.vpl_minWidth,Z.resizable("option","maxWidth",c);var e=b.size.width-b.originalSize.width;$.width($.vpl_original_width-e)}D.currentFile("adjustSize")}function r(){var a=["e","w","e","e, w"],b=0;b+=V.vpl_visible?1:0,b+=$.vpl_visible?2:0,Z.resizable("destroy"),ba.handles=a[b],ba.disable=0===b,Z.resizable(ba)}function s(){var b=a(window).outerHeight();b-=S.offset().top+S.height()+(N?p():20),b<150&&(b=150),U.height(b);var c=b-3*p();Z.height(c),$.vpl_visible&&($.height(c+p()),_.accordion("refresh")),V.vpl_visible&&(X.height(c-(W.outerHeight()+p())),V.height(c))}function t(){D.currentFile("focus")}function u(b,d){return c.showMessage(b,a.extend({},ca,d))}function v(b){if("click"==b.type||"keypress"==b.type&&13==b.keyCode){da.dialog("close");var c={name:a("#vpl_ide_input_newfilename").val(),contents:"",encoding:0},d=D.addFile(c,!1,H,G);return d&&(D.open(d),Z.tabs("option","active",D.getTabPos(d)),d.focus()),!1}}function w(b){("click"==b.type||"keypress"==b.type&&13==b.keyCode)&&(fa.dialog("close"),D.renameFile(D.currentFile("getFileName"),a("#vpl_ide_input_renamefilename").val(),G),b.preventDefault())}function x(){c.requestAction("resetfiles","",{},i.ajaxurl).done(function(a){var b=a.files;for(var d in b)b.hasOwnProperty(d)&&D.addFile(b[d],!0,c.doNothing,G);D.fileListVisibleIfNeeded(),c.delay("updateMenu",H)}).fail(G)}function y(){c.requestAction("correctedfiles","",{},i.ajaxurl).done(function(a){var b=a.files;for(var d in b)D.addFile(b[d],!0,c.doNothing,G);D.fileListVisibleIfNeeded()}).fail(G)}function z(a,b,d){d||(d={}),wa.isConnected()||c.requestAction(a,"",d,i.ajaxurl).done(function(d){c.webSocketMonitor(d,a,b,za)}).fail(G)}function A(){z("run","running",{XGEOMETRY:va.getCanvasSize()})}function B(){z("debug","debugging",{XGEOMETRY:va.getCanvasSize()})}function C(){z("evaluate","evaluating")}var D,E,F,G,H,I=this,J=i.minfiles||0,K=i.maxfiles||0,L=i.restrictededitor||i.example,M=i.example,N=!1,O=c.scrollBarWidth();c.setStr(i.i18n);var P=c.str,Q=a("#"+b);if(a("head").append('<meta name="viewport" content="initial-scale=1">').append('<meta name="viewport" width="device-width">').append('<link rel="stylesheet" href="../editor/VPLIDE.css"/>'),"object"!=typeof Q)throw"VPL: constructor tag_id not found";var R={"new":!0,rename:!0,"delete":!0,save:!0,run:!0,edit:!0,debug:!0,evaluate:!0,"import":!0,resetfiles:!0,correctedfiles:!0,sort:!0,multidelete:!0,acetheme:!0,console:!0,comments:!0};"undefined"==typeof i.loadajaxurl&&(i.loadajaxurl=i.ajaxurl),function(){var a=J<K;i["new"]=a,i.rename=a,i["delete"]=a,i.comments=i.comments&&!i.example,i.acetheme=!0}(),i.sort=K-J>=2,i.multidelete=i.sort,i["import"]=!L,i.console=j("run")||j("debug"),"undefined"==typeof i.fontSize&&(i.fontSize=12),i.fontSize=parseInt(i.fontSize),Q.on("drop",l),Q.on("dragover",k);var S=a("#vpl_menu"),T=new e(S,j),U=a("#vpl_tr"),V=a("#vpl_filelist"),W=a("#vpl_filelist_header"),X=a("#vpl_filelist_content"),Y=a("#vpl_tabs_ul"),Z=a("#vpl_tabs"),$=a("#vpl_results"),_=a("#vpl_results_accordion");V.vpl_minWidth=80,$.vpl_minWidth=100,this.updateEvaluationNumber=function(a){if("undefined"!=typeof a.nevaluations){var b=a.nevaluations;"undefined"!=typeof a.reductionbyevaluation&&a.reductionbyevaluation>""&&0!=a.reductionbyevaluation&&(0!=a.freeevaluations&&(b=b+"/"+a.freeevaluations),b=b+" -"+a.reductionbyevaluation),T.setExtracontent("evaluate",b)}},this.lastResult=null,this.getTerminal=function(){return ua},this.setResultGrade=function(a,b){var c="grade",d="vpl_ide_accordion_t_"+c,e="vpl_ide_accordion_c_"+c;if(0==_.find("."+e).length&&(_.append('<div class="'+d+'"></div>'),_.append('<div class="'+e+'"></div>')),"undefined"==typeof b)return _.find("h4."+d).length>0;var f=_.find("."+d);return a>""?(f.replaceWith('<h4 class="'+d+'">'+a+"</h4>"),!0):(f.replaceWith('<div class="'+d+'"></div>'),!1)},this.setResultTab=function(b,c,d){var e="vpl_ide_accordion_t_"+b,f="vpl_ide_accordion_c_"+b;if(0==_.find("."+f).length&&(_.append('<div class="'+e+'"></div>'),_.append('<div class="'+f+'"></div>')),"undefined"==typeof d)return _.find("h4."+e).length>0;var g=_.find("."+e),h=_.find("."+f),i=a("<div>"+c+"</div>");return i.find("h4").replaceWith(function(){return a("<h5>").append(a(this).contents())}),h.html()==i.html()?c>"":c>""?(g.replaceWith('<h4 class="'+e+'">'+P(b)+"</h4>"),h.replaceWith('<div class="ui-widget '+f+'">'+i.html()+"</div>"),!0):(g.replaceWith('<div class="'+e+'"></div>'),h.replaceWith('<div class="'+f+'"></div>'),!1)},this.setResult=function(a,b){I.updateEvaluationNumber(a);var d,e=D.getFiles(),f=[];for(d=0;d<e.length;d++)f[d]=e[d].getFileName(),e[d].clearAnnotations();var g,h,j,k=!1,l=c.sanitizeText(a.grade);if(h=I.setResultGrade(l,a.grade),k=k||h,g=I.setResultTab("variables",a.variables,a.variables),k=k||g,j=c.processResult(a.compilation,f,e,!0,!1),g=I.setResultTab("compilation",j,a.compilation),k=k||g,j=c.processResult(a.evaluation,f,e,!1,!1),g=I.setResultTab("comments",j,a.evaluation),k=k||g,j=c.sanitizeText(a.execution),g=I.setResultTab("execution",j,a.execution),k=k||g,g=I.setResultTab("description",i.description,i.description),k=k||g){for($.show(),$.vpl_visible=!0,_.accordion("refresh"),_.accordion("option","active",h?1:0),d=0;d<e.length;d++)for(var m=e[d].getAnnotations(),n=0;n<m.length;n++)if(b||"error"==m[n].type){D.gotoFile(d,m[n].row+1);break}}else $.hide(),$.vpl_visible=!1;c.delay("autoResizeTab",F)},_.accordion({heightStyle:"fill",header:"h4",animate:!1,beforeActivate:n}),$.width(2*$.vpl_minWidth),_.on("click","a",function(a){a.preventDefault(),D.gotoFileLink(a.currentTarget)}),$.vpl_visible=!1,$.hide(),V.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),W.text(P("filelist")),W.html(c.iconFolder()+W.html()),W.addClass("ui-widget-header ui-button-text-only ui-corner-all"),X.addClass("ui-widget ui-corner-all"),V.width(2*V.vpl_minWidth),V.on("click","a",function(a){a.preventDefault(),D.gotoFileLink(a.currentTarget)}),V.vpl_visible=!1,V.hide(),Z.tabs({classes:{"ui-tabs-panel":null}});var aa=!1,ba={containment:"parent",resize:q,start:function(){a(window).off("resize",F),Z.resizable("option","minWidth",100),$.vpl_visible&&($.vpl_original_width=$.width()),V.vpl_visible&&(V.vpl_original_width=V.width())},stop:function(b,c){q(b,c),Z.resizable("option","maxWidth",1e5),Z.resizable("option","minWidth",0),F(),a(window).on("resize",F)},handles:""};Z.resizable(ba),E=function(b){var c=Z.width(),d=0;Y.width(1e5);var e=Y.children("li:visible").last();if(e.length){var f=Y.parent().scrollLeft();d=f+e.position().left+e.width()+aa,Y.width(d);var g=D.currentFile();if(g&&b){var h=a(g.getTabNameId()),i=f+h.position().left;i-=(c-h.outerWidth())/2,i<0&&(i=0),Y.parent().finish().animate({scrollLeft:i},"slow")}}d<c&&Y.width("")},F=function(){var a=Z.width(),b=S.width(),c=!1;if(r(),U.width(S.outerWidth()),V.vpl_visible){var d=V.outerWidth()+aa;a+=d,d>=100?(b-=d,Z.css("left",d)):c=!0}else Z.css("left",0);if($.vpl_visible){var e=$.outerWidth()+aa;a+=e,b-=e,b<100&&(c=!0)}if(c){var f=S.width()/a,g=0;V.vpl_visible&&(g=V.width()*f,V.width(g-aa),g+=aa,Z.css("left",g)),Z.width(Z.width()*f),$.vpl_visible&&$.width(S.width()-(g+Z.width()+aa))}else Z.width(b);E(!0),s(),D.currentFile("adjustSize")};var ca=a.extend({},{close:t},c.dialogbaseOptions);G=function(a){return c.showErrorMessage(a,{close:t})};var da=a("#vpl_ide_dialog_new"),ea={};ea[P("ok")]=v,ea[P("cancel")]=function(){a(this).dialog("close")},da.find("input").on("keypress",v),da.dialog(a.extend({},ca,{title:P("create_new_file"),buttons:ea}));var fa=a("#vpl_ide_dialog_rename");fa.find("input").on("keypress",w),ea[P("ok")]=w,fa.dialog(a.extend({},ca,{open:function(){a("#vpl_ide_input_renamefilename").val(D.currentFile("getFileName"))},title:P("rename_file"),buttons:ea})),ea[P("ok")]=function(){a(this).dialog("close")};var ga=a("#vpl_ide_dialog_comments");ga.dialog(a.extend({},ca,{title:P("comments"),width:"40em",buttons:ea})),a("#vpl_ide_input_comments").width("30em");var ha=a("#vpl_ide_dialog_about"),ia={};ia[P("ok")]=function(){a(this).dialog("close")};var ja=a("#vpl_ide_dialog_shortcuts");ja.dialog(a.extend({},ca,{open:function(){var b=T.getShortcuts(D.currentFile("getEditor"));a("#vpl_ide_dialog_shortcuts").html(b)},title:P("shortcuts"),width:400,height:300,buttons:ia})),ja.dialog("option","height",300),ia[P("shortcuts")]=function(){a(this).dialog("close"),ja.dialog("open")},ha.dialog(a.extend({},ca,{open:function(){var b=T.getShortcuts(D.currentFile("getEditor"));ha.next().find("button").filter(function(){return a(this).text()==P("shortcuts")}).button(""!=b?"enable":"disable")},title:P("about"),width:400,height:300,buttons:ia})),ha.dialog("option","height",300);var ka=a("#vpl_ide_dialog_sort"),la={};la[P("ok")]=function(){var b=D.getFiles(),d=/[^\d]*/,e=[],f=0,g=a("#vpl_sort_list li");if(g.length==b.length){for(g.each(function(){var a=parseInt(this.id.replace(d,""));e.push(b[a])}),f=0;f<g.length;f++)b[f]=e[f];D.setModified(),c.delay("updateMenu",H),c.delay("updateFileList",D.updateFileList),a(this).dialog("close")}},la[P("cancel")]=function(){a(this).dialog("close")},ka.dialog(a.extend({},ca,{title:P("sort"),buttons:la,open:function(){var b=a("#vpl_sort_list");b.html("");for(var c=D.getFiles(),d=0;d<c.length;d++){var e=a('<li id="vpl_fsort_'+d+'"class="ui-widget-content"></li>');d<J&&e.addClass("ui-state-disabled"),e.text(d+1+"-"+c[d].getFileName()),b.append(e)}b.sortable({items:"li:not(.ui-state-disabled)",placeholder:"ui-state-highlight",start:function(a,b){b.item.addClass("ui-state-highlight")},stop:function(a,b){b.item.removeClass("ui-state-highlight")}}),b.disableSelection()},maxHeight:400}));var ma=a("#vpl_ide_dialog_multidelete"),na={};na[P("selectall")]=function(){a(this).find("input").prop("checked",!0)},na[P("deselectall")]=function(){a(this).find("input").prop("checked",!1)},na[P("deleteselected")]=function(){var b=D.getFiles(),d=[],e=a("#vpl_multidelete_list label");e.each(function(){var c=a(this);if(c.find("input").prop("checked")){var e=c.data("fileid");d.push(b[e].getFileName())}});for(var f=0;f<d.length;f++)D.deleteFile(d[f],!1,G);c.delay("updateMenu",H),c.delay("updateFileList",D.updateFileList),a(this).dialog("close")},na[P("cancel")]=function(){a(this).dialog("close")},ma.dialog(a.extend({},ca,{title:P("multidelete"),buttons:na,open:function(){var b=a("#vpl_multidelete_list");b.html("");for(var d=D.getFiles(),e=J;e<d.length;e++){var f=c.sanitizeText(d[e].getFileName()),g=a('<label><input type="checkbox"> '+f+"</label>");g.data("fileid",e),b.append(g),b.append("<br>")}b.find("label").button()},maxHeight:400,maxWidth:400}));var oa=a("#vpl_ide_dialog_fontsize"),pa=a("#vpl_ide_dialog_fontsize .vpl_fontsize_slider"),qa={};qa[P("ok")]=function(){var b=pa.slider("value");D.setFontSize(b),a(this).dialog("close"),a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({fontSize:b}),contentType:"application/json; charset=utf-8",dataType:"json"})},qa[P("cancel")]=function(){D.setFontSize(pa.data("vpl_fontsize")),a(this).dialog("close")},qa[P("reset")]=function(){pa.slider("value",12)},oa.dialog(a.extend({},ca,{title:P("fontsize"),buttons:qa,open:function(){pa.data("vpl_fontsize",D.getFontSize()),pa.slider("value",D.getFontSize())}})),pa.slider({min:1,max:48,change:function(){var a=pa.slider("value");D.setFontSize(a),oa.find(".vpl_fontsize_slider_value").text(a)}});var ra=a("#vpl_ide_dialog_acetheme"),sa=a("#vpl_ide_dialog_acetheme select"),ta={};ta[P("ok")]=function(){D.setTheme(sa.val()),a(this).dialog("close"),a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({aceTheme:sa.val()}),contentType:"application/json; charset=utf-8",dataType:"json"})},ta[P("cancel")]=function(){D.setTheme(sa.data("acetheme")),a(this).dialog("close")},ta[P("reset")]=function(){sa.val(sa.data("acetheme")),D.setTheme(sa.val())},ra.dialog(a.extend({},ca,{title:P("theme"),buttons:ta,modal:!1,open:function(){sa.data("acetheme",D.getTheme()),sa.val(D.getTheme())}})),sa.on("change",function(){D.setTheme(sa.val())});var ua=new f("vpl_dialog_terminal","vpl_terminal",P),va=new g("vpl_dialog_vnc",P),wa=ua,xa=a("#vpl_ide_input_file"),ya=function(){c.readSelectedFiles(this.files,function(a){return D.addFile(a,!0,H,G)},function(){D.fileListVisibleIfNeeded()})};xa.on("change",ya),T.add({name:"filelist",originalAction:function(){D.fileListVisible(!D.isFileListVisible()),c.delay("updateMenu",H),c.delay("autoResizeTab",F),c.delay("updateFileList",D.updateFileList)},bindKey:{win:"Ctrl-L",mac:"Ctrl-L"}}),T.add({name:"new",originalAction:function(){D.length()<K&&da.dialog("open")},bindKey:{win:"Alt-N",mac:"Option-N"}}),T.add({name:"rename",originalAction:function(){var a=D.currentFile();a&&D.getFilePosById(a.getId())>=J&&fa.dialog("open")},bindKey:{win:"Ctrl-R",mac:"Ctrl-R"}}),T.add({name:"delete",originalAction:function(){var a=D.currentFile();if(a){var b=a.getFileName(),c=P("delete_file_fq").replace(/\{\$a\}/g,b);u(c,{ok:function(){D.deleteFile(b,G)},title:P("delete_file_q"),icon:"trash"})}},bindKey:{win:"Ctrl-D",mac:"Ctrl-D"}}),T.add({name:"close",originalAction:function(){var a=D.currentFile();a&&D.close(a)},bindKey:{win:"Alt-W",mac:"Option-W"}}),T.add({name:"import",originalAction:function(){xa.val(""),xa.trigger("click")},bindKey:{win:"Ctrl-I",mac:"Ctrl-I"}}),T.add({name:"sort",originalAction:function(){ka.dialog("open")},bindKey:{win:"Ctrl-O",mac:"Ctrl-O"}}),T.add({name:"multidelete",originalAction:function(){ma.dialog("open")}}),T.add({name:"fontsize",originalAction:function(){oa.dialog("open")}}),T.add({name:"acetheme",originalAction:function(){ra.dialog("open")}}),T.add({name:"print",originalAction:function(){window.print()},bindKey:{win:"Alt-P",mac:"Command-P"}}),T.add({name:"undo",originalAction:function(){D.currentFile("undo")}}),T.add({name:"redo",originalAction:function(){D.currentFile("redo")}}),T.add({name:"select_all",editorName:"selectall",originalAction:function(){D.currentFile("selectAll")}}),T.add({name:"find",originalAction:function(){D.currentFile("find")}}),T.add({name:"find_replace",editorName:"replace",originalAction:function(){D.currentFile("replace")}}),T.add({name:"next",editorName:"findnext",originalAction:function(){D.currentFile("next")}}),T.add({name:"fullscreen",originalAction:function(){var b="header, footer, aside, #page-header, div.navbar, #nav-drawer";b+=", div.tabtree, #dock, .breadcrumb-nav, .moodle-actionmenu",N?(Q.removeClass("vpl_ide_root_fullscreen"),a("body").removeClass("vpl_body_fullscreen"),T.setText("fullscreen","fullscreen"),a(b).show(),a("#vpl_ide_user").hide(),N=!1):(a("body").addClass("vpl_body_fullscreen").scrollTop(0),a(b).hide(),Q.addClass("vpl_ide_root_fullscreen"),T.setText("fullscreen","regularscreen"),i.username&&a("#vpl_ide_user").show(),N=!0),t(),setTimeout(F,10)},bindKey:{win:"Alt-F",mac:"Ctrl-F"}}),T.add({name:"download",originalAction:function(){window.location=i.download}}),T.add({name:"correctedfiles",originalAction:function(){u(P("surecorrectedfiles"),{title:P("correctedfiles"),ok:y})}}),T.add({name:"resetfiles",originalAction:function(){u(P("sureresetfiles"),{title:P("resetfiles"),ok:x})}}),T.add({name:"save",originalAction:function(){var b={files:D.getFilesToSave(),comments:a("#vpl_ide_input_comments").val()};c.requestAction("save","saving",b,i.ajaxurl).done(function(a){D.resetModified(),T.setTimeLeft(a),c.delay("updateMenu",H)}).fail(G)},bindKey:{win:"Ctrl-S",mac:"Command-S"}});var za={getConsole:function(){return wa},setResult:I.setResult,ajaxurl:i.ajaxurl,run:function(a,b,c){"terminal"==a?(wa=ua,ua.connect(b.executionURL,function(){c.close(),t()})):(wa=va,va.connect(b.secure,b.server,b.portToUse,b.VNCpassword,b.executionPath,function(){c.close(),t()}))},lastAction:!1,getLastAction:function(){var a=this.lastAction;return this.lastAction=!1,a},setLastAction:function(a){this.lastAction=a}};T.add({name:"run",originalAction:function(){za.setLastAction(A),A()},bindKey:{win:"Ctrl-F11",mac:"Command-U"}}),T.add({name:"debug",originalAction:function(){za.setLastAction(B),B()},bindKey:{win:"Alt-F11",mac:"Option-U"}}),T.add({name:"evaluate",originalAction:function(){za.setLastAction(C),C()},bindKey:{win:"Shift-F11",mac:"Command-Option-U"}}),T.add({name:"comments",originalAction:function(){ga.dialog("open")}}),T.add({name:"console",originalAction:function(){wa.show()}}),T.add({name:"user"}),T.add({name:"about",originalAction:function(){ha.dialog("open")}}),T.add({name:"timeleft",originalAction:function(){T.toggleTimeLeft()}}),T.add({name:"more",originalAction:function(){var b=a("#vpl_ide_menuextra");b.is(":visible")?(T.setText("more","more",c.str("more")),b.hide()):(T.setText("more","less",c.str("less")),b.show()),c.delay("updateMenu",H),c.delay("autoResizeTab",F)}}),S.addClass("ui-widget-header ui-corner-all");var Aa="";Aa+=T.getHTML("more"),Aa+=T.getHTML("save"),Aa+="<span id='vpl_ide_mexecution'>",Aa+=T.getHTML("run"),Aa+=T.getHTML("debug"),Aa+=T.getHTML("evaluate"),Aa+=T.getHTML("comments"),Aa+=T.getHTML("console"),Aa+="</span> ",Aa+="<span id='vpl_ide_menuextra'>",Aa+="<span id='vpl_ide_file'>",Aa+=T.getHTML("filelist"),Aa+=T.getHTML("new"),Aa+=T.getHTML("rename"),Aa+=T.getHTML("delete"),Aa+=T.getHTML("import"),Aa+=T.getHTML("download"),Aa+=T.getHTML("resetfiles"),Aa+=T.getHTML("correctedfiles"),Aa+=T.getHTML("sort"),Aa+=T.getHTML("multidelete"),Aa+=T.getHTML("fontsize"),Aa+=T.getHTML("acetheme"),Aa+="</span> ",Aa+="<span id='vpl_ide_edit'>",Aa+=T.getHTML("undo"),Aa+=T.getHTML("redo"),Aa+=T.getHTML("select_all"),Aa+=T.getHTML("find"),Aa+=T.getHTML("find_replace"),Aa+=T.getHTML("next"),Aa+="</span> ",Aa+="</span> ",Aa+=T.getHTML("fullscreen")+" ",Aa+=T.getHTML("about")+" ",Aa+=T.getHTML("user")+" ",Aa+=T.getHTML("timeleft"),Aa+='<div class="clearfix"></div>',S.append(Aa),a("#vpl_ide_more").button(),a("#vpl_ide_save").button(),a("#vpl_ide_menuextra").hide(),a("#vpl_ide_file").controlgroup(),a("#vpl_ide_edit").controlgroup(),a("#vpl_ide_mexecution").controlgroup(),a("#vpl_ide_fullscreen").button(),a("#vpl_ide_acetheme").button(),a("#vpl_ide_about").button(),a("#vpl_ide_user").button().css("float","right").hide(),a("#vpl_ide_timeleft").button().css("float","right").hide(),a("#vpl_menu .ui-button").css("padding","6px"),a("#vpl_menu .ui-button-text").css("padding","0");for(var Ba=["filelist","more","fullscreen","about","resetfiles","download","comments","console","import","fontsize"],Ca=0;Ca<Ba.length;Ca++)T.enable(Ba[Ca],!0);T.setExtracontent("user",i.username),T.setTimeLeft(i),H=function(){var a,b=D.currentFile(),d=D.length();d?Z.show():Z.hide(),D.isFileListVisible()?T.setText("filelist","filelistclose",c.str("filelist")):T.setText("filelist","filelist",c.str("filelist")),c.log("updateMenu",!0);var e=D.isModified();T.enable("save",e),T.enable("run",!e),T.enable("debug",!e),T.enable("evaluate",!e),T.enable("download",!e),T.enable("new",d<K),T.enable("sort",d-J>1),T.enable("multidelete",d-J>1),T.enable("acetheme",!0),T.enable("correctedfiles",i.correctedfiles);var f;if(b&&0!==d){var g=D.getFilePosById(b.getId());T.enable("rename",g>=J&&0!==d),T.enable("delete",g>=J&&0!==d),T.enable("undo",b.hasUndo()),T.enable("redo",b.hasRedo()),T.enable("select_all",b.hasSelectAll()),T.enable("find",b.hasFind()),T.enable("find_replace",b.hasFindReplace()),T.enable("next",b.hasNext()),c.delay("updateFileList",D.updateFileList)}else for(f=["rename","delete","undo","redo","select_all","find","find_replace","next"],a=0;a<f.length;a++)T.enable(f[a],!1)},Z.on("tabsactivate",function(){D.currentFile("focus"),c.delay("updateMenu",H),c.delay("autoResizeTab",F)});var Da=a(window);Da.on("resize",F),i.example||Da.on("beforeunload",function(){if(D.isModified())return P("changesNotSaved")}),D=new o,F(),function(){function a(){var a=S.width();b!=a&&(b=a,F())}var b=S.width();a(),setInterval(a,1e3)}(),D.resetModified(),c.requestAction("load","loading",i,i.loadajaxurl).done(function(b){for(var d=!0,e=b.files,f=0;f<e.length;f++){var g=e[f],h=D.addFile(g,!1,H,G);h?(h.resetModified(),f<J||e.length<=5?D.open(h):D.fileListVisible(!0)):d=!1}c.delay("updateMenu",H),D.generateFileList(),Z.tabs("option","active",0),b.compilationexecution&&I.setResult(b.compilationexecution,!1),T.setTimeLeft(b),b.comments>""&&a("#vpl_ide_input_comments").val(b.comments),d?D.resetModified():D.setModified(),0===D.length()&&K>0?T.getAction("new")():i.saved||D.setModified()}).fail(G)};return window.VPLIDE=i,{init:function(a,b){h=new i(a,b)}}});